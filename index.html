<!doctype html>
<head><meta charset="utf-8"><title>import()</title><script type="application/json" id="menu-search-biblio">[{"type":"clause","id":"introduction","aoid":null,"title":"Introduction","titleHTML":"Introduction","number":"","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Introduction"},{"type":"op","aoid":"HostResolveImportedModule","refId":"sec-hostresolveimportedmodule","location":"","key":"HostResolveImportedModule"},{"type":"clause","id":"sec-hostresolveimportedmodule","aoid":"HostResolveImportedModule","title":"Runtime Semantics: HostResolveImportedModule (  referencingModulereferencingScriptOrModule, specifier )","titleHTML":"Runtime Semantics: HostResolveImportedModule (  <del><var>referencingModule</var></del><ins><var>referencingScriptOrModule</var></ins>, <var>specifier</var> )","number":"1.1.1","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Runtime Semantics: HostResolveImportedModule (  referencingModulereferencingScriptOrModule, specifier )"},{"type":"op","aoid":"HostPrepareImportedModule","refId":"sec-hostprepareimportedmodule","location":"","key":"HostPrepareImportedModule"},{"type":"clause","id":"sec-hostprepareimportedmodule","aoid":"HostPrepareImportedModule","title":"Runtime Semantics: HostPrepareImportedModule ( referencingScriptOrModule, specifier )","titleHTML":"<ins>Runtime Semantics: HostPrepareImportedModule ( <var>referencingScriptOrModule</var>, <var>specifier</var> )</ins>","number":"1.1.2","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Runtime Semantics: HostPrepareImportedModule ( referencingScriptOrModule, specifier )"},{"type":"clause","id":"sec-module-semantics","aoid":null,"title":"Module Semantics","titleHTML":"Module Semantics","number":"1.1","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Module Semantics"},{"type":"clause","id":"sec-modules","aoid":null,"title":"Modules","titleHTML":"Modules","number":"1","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Modules"},{"type":"production","id":"prod-CallExpression","name":"CallExpression","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"CallExpression"},{"type":"production","id":"prod-ImportCall","name":"ImportCall","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"ImportCall"},{"type":"clause","id":"sec-import-call-runtime-semantics-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"2.1.1","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Runtime Semantics: Evaluation"},{"type":"clause","id":"sec-import-calls","aoid":null,"title":"Import Calls","titleHTML":"Import Calls","number":"2.1","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Import Calls"},{"type":"clause","id":"sec-left-hand-side-expressions","aoid":null,"title":"Left-Hand-Side Expressions","titleHTML":"Left-Hand-Side Expressions","number":"2","namespace":"https://domenic.github.io/proposal-dynamic-import/","location":"","key":"Left-Hand-Side Expressions"}]</script></head><body><div id="menu-toggle">☰</div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#introduction" title="Introduction"><span class="secnum"></span> Introduction</a></li><li><span class="item-toggle">◢</span><a href="#sec-modules" title="Modules"><span class="secnum">1</span> Modules</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-module-semantics" title="Module Semantics"><span class="secnum">1.1</span> Module Semantics</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-hostresolveimportedmodule" title="Runtime Semantics: HostResolveImportedModule (  referencingModulereferencingScriptOrModule, specifier )"><span class="secnum">1.1.1</span> RS: HostResolveImportedModule (  <del><var>referencingModule</var></del><ins><var>referencingScriptOrModule</var></ins>, <var>specifier</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-hostprepareimportedmodule" title="Runtime Semantics: HostPrepareImportedModule ( referencingScriptOrModule, specifier )"><span class="secnum">1.1.2</span> <ins>RS: HostPrepareImportedModule ( <var>referencingScriptOrModule</var>, <var>specifier</var> )</ins></a></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-left-hand-side-expressions" title="Left-Hand-Side Expressions"><span class="secnum">2</span> Left-Hand-Side Expressions</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-import-calls" title="Import Calls"><span class="secnum">2.1</span> Import Calls</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-import-call-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">2.1.1</span> RS: Evaluation</a></li></ol></li></ol></li></ol></div></div><h1 class="version">Stage 2 Draft / October 30, 2016</h1><h1 class="title">import()</h1>
<script src="https://bterlson.github.io/ecmarkup/ecmarkup.js" defer=""></script>
<link rel="stylesheet" href="https://bterlson.github.io/ecmarkup/elements.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_light.min.css">

<emu-intro id="introduction">
  <h1><span class="secnum"></span>Introduction<span class="utils"><span class="anchor"><a href="#introduction">#</a></span></span></h1>

  <p>Background explanatory material for this specification can be found in the  <a href="https://github.com/domenic/proposal-dynamic-import">domenic/proposal-dynamic-import</a> repository. See also the  <a href="https://github.com/tc39/proposal-dynamic-import/issues">issues</a> and the  <a href="https://github.com/domenic/proposal-dynamic-import/blob/master/HTML%20Integration.md">HTML integration spec</a> that builds on top of the below JavaScript specification.</p>
</emu-intro>

<emu-clause id="sec-modules">
  <h1><span class="secnum">1</span>Modules<span class="utils"><span class="anchor"><a href="#sec-modules">#</a></span></span></h1>

  <emu-clause id="sec-module-semantics">
    <h1><span class="secnum">1.1</span>Module Semantics<span class="utils"><span class="anchor"><a href="#sec-module-semantics">#</a></span></span></h1>

    <emu-clause id="sec-hostresolveimportedmodule" aoid="HostResolveImportedModule">
      <h1><span class="secnum">1.1.1</span>Runtime Semantics: HostResolveImportedModule (  <del><var>referencingModule</var></del><ins><var>referencingScriptOrModule</var></ins>, <var>specifier</var> )<span class="utils"><span class="anchor"><a href="#sec-hostresolveimportedmodule">#</a></span></span></h1>

      <p>HostResolveImportedModule is an implementation defined abstract operation that provides the concrete <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> subclass instance that corresponds to the <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ModuleSpecifier">ModuleSpecifier</a></emu-nt> String, <var>specifier</var>, occurring within the context of the  <ins>script or  </ins>module represented by the  <ins><emu-xref href="#script-record"><a href="https://tc39.github.io/ecma262/#script-record">Script Record</a></emu-xref> or  </ins><emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref>  <del><var>referencingModule</var></del><ins><var>referencingScriptOrModule</var></ins>.</p>
      <p>The implementation of HostResolveImportedModule must conform to the following requirements:</p>

      <ul>
        <li>
          The normal return value must be an instance of a concrete subclass of <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref>.
        
        </li>
        <li>
          If a <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> corresponding to the pair  <del><var>referencingModule</var></del><ins><var>referencingScriptOrModule</var></ins>, <var>specifier</var> does not exist or cannot be created, an exception must be thrown.
        
        </li>
        <li>
          This operation must be idempotent if it completes normally. Each time it is called with a specific  <del><var>referencingModule</var></del><ins><var>referencingScriptOrModule</var></ins>, <var>specifier</var> pair as arguments it must return the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance.
        
        </li>
      </ul>

      <p>Multiple different  <del><var>referencingModule</var></del><ins><var>referencingScriptOrModule</var></ins>, <var>specifier</var> pairs may map to the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance. The actual mapping semantic is implementation defined but typically a normalization process is applied to <var>specifier</var> as part of the mapping process. A typical normalization process would include actions such as alphabetic case folding and expansion of relative and abbreviated path specifiers.</p>
    </emu-clause>

    <emu-clause id="sec-hostprepareimportedmodule" aoid="HostPrepareImportedModule">
      <h1><span class="secnum">1.1.2</span><ins>Runtime Semantics: HostPrepareImportedModule ( <var>referencingScriptOrModule</var>, <var>specifier</var> )</ins><span class="utils"><span class="anchor"><a href="#sec-hostprepareimportedmodule">#</a></span></span></h1>

      <p>HostPrepareImportedModule is an implementation defined abstract operation that asynchronously performs any necessary setup work in order to make available the module corresponding to the <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ModuleSpecifier">ModuleSpecifier</a></emu-nt> String, <var>specifier</var>, occurring within the context of the script or module represented by the <emu-xref href="#script-record"><a href="https://tc39.github.io/ecma262/#script-record">Script Record</a></emu-xref> or <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> <var>referencingScriptOrModule</var>. This prepares the host environment for future calls to <emu-xref aoid="HostResolveImportedModule"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> with the same arguments.</p>
      <p>The implementation of HostPrepareImportedModule must conform to the following requirements:</p>

      <ul>
        <li>
          The abstract operation must always complete with <emu-val>undefined</emu-val>. Success or failure must instead be signaled by using the phrase "asynchronously complete with" and giving a completion record (which may be either a normal completion, signaling success, or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, signaling failure).
        
        </li>
        <li>
          If the operation succeeds, the asynchronous completion value must be a normal completion whose [[Value]] field is <emu-val>undefined</emu-val>.
        
        </li>
        <li>
          If the operation succeeds, a subsequent call to <emu-xref aoid="HostResolveImportedModule"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> given the same arguments must complete normally.
        
        </li>
        <li>
          If the operation succeeds, the completion value of a subsequent call to <emu-xref aoid="HostResolveImportedModule"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> given the same arguments must be a module which has already been evaluated, i.e. whose ModuleEvaluation concrete method has already been called and returned a normal completion.
        
        </li>
        <li>
          If the operation fails, the asynchronous completion value must be an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.
        
        </li>
      </ul>

      <p>The actual process performed is implementation defined, but typically consists of performing whatever I/O operations are necessary to allow <emu-xref aoid="HostResolveImportedModule"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> to synchronously retrieve the appropriate <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref>, and then calling its ModuleEvaluation concrete method. This might require performing similar normalization as <emu-xref aoid="HostResolveImportedModule"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> does during an initial step.</p>
    </emu-clause>
  </emu-clause>
</emu-clause>

<emu-clause id="sec-left-hand-side-expressions">
  <h1><span class="secnum">2</span>Left-Hand-Side Expressions<span class="utils"><span class="anchor"><a href="#sec-left-hand-side-expressions">#</a></span></span></h1>
  <h2>Syntax</h2>
  <emu-grammar><emu-production name="CallExpression" params="Yield" id="prod-CallExpression">
    <emu-nt params="Yield"><a href="#prod-CallExpression">CallExpression</a><emu-mods><emu-params>[Yield]</emu-params></emu-mods></emu-nt><emu-geq>:</emu-geq><emu-rhs a="eed49138"><emu-nt params="?Yield"><a href="https://tc39.github.io/ecma262/#prod-MemberExpression">MemberExpression</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt><emu-nt params="?Yield"><a href="https://tc39.github.io/ecma262/#prod-Arguments">Arguments</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt></emu-rhs>
    <emu-rhs a="91ffa870"><emu-nt params="?Yield"><a href="https://tc39.github.io/ecma262/#prod-SuperCall">SuperCall</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt></emu-rhs><ins>
    <emu-rhs a="9977a717"><emu-nt params="?Yield"><a href="#prod-ImportCall">ImportCall</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt></emu-rhs></ins>
    <emu-rhs a="13f81c0e"><emu-nt params="?Yield"><a href="#prod-CallExpression">CallExpression</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt><emu-nt params="?Yield"><a href="https://tc39.github.io/ecma262/#prod-Arguments">Arguments</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt></emu-rhs>
    <emu-rhs a="adc1e181"><emu-nt params="?Yield"><a href="#prod-CallExpression">CallExpression</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt><emu-t>[</emu-t><emu-nt params="+In, ?Yield"><a href="https://tc39.github.io/ecma262/#prod-Expression">Expression</a><emu-mods><emu-params>[+In, ?Yield]</emu-params></emu-mods></emu-nt><emu-t>]</emu-t></emu-rhs>
    <emu-rhs a="710733f7"><emu-nt params="?Yield"><a href="#prod-CallExpression">CallExpression</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt><emu-t>.</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt></emu-rhs>
    <emu-rhs a="e3527637"><emu-nt params="?Yield"><a href="#prod-CallExpression">CallExpression</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt><emu-nt params="?Yield"><a href="https://tc39.github.io/ecma262/#prod-TemplateLiteral">TemplateLiteral</a><emu-mods><emu-params>[?Yield]</emu-params></emu-mods></emu-nt></emu-rhs>
</emu-production><ins>
<emu-production name="ImportCall" params="Yield" id="prod-ImportCall">
    <emu-nt params="Yield"><a href="#prod-ImportCall">ImportCall</a><emu-mods><emu-params>[Yield]</emu-params></emu-mods></emu-nt><emu-geq>:</emu-geq><emu-rhs a="0fa80ab5"><emu-t>import</emu-t><emu-t>(</emu-t><emu-nt params="+In, ?Yield"><a href="https://tc39.github.io/ecma262/#prod-AssignmentExpression">AssignmentExpression</a><emu-mods><emu-params>[+In, ?Yield]</emu-params></emu-mods></emu-nt><emu-t>)</emu-t></emu-rhs>
</emu-production></ins></emu-grammar>

  <p>(Also, many other instances of <emu-nt><a href="#prod-CallExpression">CallExpression</a></emu-nt> need to get <emu-nt><a href="#prod-ImportCall">ImportCall</a></emu-nt> added to them.)</p>

  <emu-clause id="sec-import-calls">
    <h1><span class="secnum">2.1</span>Import Calls<span class="utils"><span class="anchor"><a href="#sec-import-calls">#</a></span></span></h1>

    <emu-clause id="sec-import-call-runtime-semantics-evaluation">
      <h1><span class="secnum">2.1.1</span>Runtime Semantics: Evaluation<span class="utils"><span class="anchor"><a href="#sec-import-call-runtime-semantics-evaluation">#</a></span></span></h1>

      <emu-grammar><emu-production name="ImportCall" collapsed="">
    <emu-nt><a href="#prod-ImportCall">ImportCall</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="26c293e4"><emu-t>import</emu-t><emu-t>(</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt><emu-t>)</emu-t></emu-rhs>
</emu-production></emu-grammar>
      <emu-alg><ol><li>Let <var>referencingScriptOrModule</var> be ! <emu-xref aoid="GetActiveScriptOrModule"><a href="https://tc39.github.io/ecma262/#sec-getactivescriptormodule">GetActiveScriptOrModule</a></emu-xref>().</li><li>Assert: <var>referencingScriptOrModule</var> is a <emu-xref href="#script-record"><a href="https://tc39.github.io/ecma262/#script-record">Script Record</a></emu-xref> or <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.github.io/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> (i.e. is not <emu-val>null</emu-val>).</li><li>Let <var>argRef</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt>.</li><li>Let <var>specifier</var> be ? <emu-xref aoid="GetValue"><a href="https://tc39.github.io/ecma262/#sec-getvalue">GetValue</a></emu-xref>(<var>argRef</var>).</li><li>Let <var>promiseCapability</var> be ! <emu-xref aoid="NewPromiseCapability"><a href="https://tc39.github.io/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.github.io/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>specifierString</var> be <emu-xref aoid="ToString"><a href="https://tc39.github.io/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>specifier</var>).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.github.io/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>specifierString</var>, <var>promiseCapability</var>).</li><li>Return <var>promiseCapability</var>.[[Promise]], but continue running the following steps:<ol><li>Perform ! <emu-xref aoid="HostPrepareImportedModule"><a href="#sec-hostprepareimportedmodule">HostPrepareImportedModule</a></emu-xref>(<var>referencingScriptOrModule</var>, <var>specifierString</var>). When it asynchronously completes, let <var>prepareResult</var> be the resulting asynchronous completion value, and continue to the next step.</li><li>If <var>prepareResult</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then perform ! <emu-xref aoid="Call"><a href="https://tc39.github.io/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, « <var>prepareResult</var>.[[Value]] »).</li><li>Otherwise,<ol><li>Assert: <var>prepareResult</var> is a normal completion and <var>prepareResult</var>.[[Value]] is <emu-val>undefined</emu-val>.</li><li>Let <var>moduleRecord</var> be ! <emu-xref aoid="HostResolveImportedModule"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref>(<var>referencingScriptOrModule</var>, <var>specifierString</var>).</li><li>Assert: ModuleEvaluation has already been invoked on <var>moduleRecord</var> and successfully completed.</li><li>Perform ! <emu-xref aoid="Call"><a href="https://tc39.github.io/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, « <var>moduleRecord</var>.[[Namespace]] »).
      </li></ol></li></ol></li></ol></emu-alg>
    </emu-clause>
  </emu-clause>
</emu-clause>
</body>